# Проектная работа "Веб-ларек" 

https://github.com/DaryaSave/web-larek-frontend.git  

 
## Краткое описание 

Веб-приложение интернет-магазина с корзиной, оформлением заказа и взаимодействием с API.   

Стек: TypeScript, HTML, SCSS, Webpack. 

 
Структура проекта: 

- src/ — исходные файлы проекта 
- src/components/ — папка с JS компонентами 
- src/components/base/ — папка с базовым кодом 


Важные файлы: 

- src/pages/index.html — HTML-файл главной страницы 
- src/types/index.ts — файл с типами 
- src/index.ts — точка входа приложения 
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами 
- src/utils/utils.ts — файл с утилитами 
 

## Установка и запуск 

Для установки и запуска проекта необходимо выполнить команды 

``` 
npm install 

npm run start 

``` 

или 

``` 
yarn 

yarn start 

``` 
## Сборка 

``` 
npm run build 

``` 
или 

``` 
yarn build 

```

## Архитектура проекта 

### Основные части 

**Типы данных (types/)** — описание структуры данных для товаров, корзины, заказов, API и событий. 

**Базовые классы (components/base/)** — инфраструктурные классы: EventEmitter (событийная шина), Api (клиент для запросов к серверу). 

**Компоненты интерфейса (components/)** — визуальные и логические компоненты (карточки товаров, корзина, формы, модальные окна и т.д.). 

**Утилиты (utils/)** — вспомогательные функции для работы с DOM, шаблонами и данными. 


### Взаимодействие частей 
- Взаимодействие между компонентами реализовано через события (паттерн "Наблюдатель", EventEmitter). 
- Запросы к серверу изолированы в классе Api. 
- Все DOM-элементы, с которыми работают компоненты, кэшируются в свойствах для повышения производительности. 
- Повторяющийся код вынесен в утилиты. 

### Типы данных 

**Типы товаров:**  
- `IProductItem` — интерфейс, описывающий товар:  
- `id` — идентификатор товара.  
- `title` — название товара.  
- `description` — описание товара.  
- `price` — стоимость товара.  
- `imageUrl` — URL изображения товара.  
- `category` — категория товара.  

**Типы корзины:**  
- `ICartItem` — элемент корзины:  
- `product` — объект товара (`IProductItem`).  
- `quantity` — количество единиц товара в корзине.  
- `IBasketItem` — расширенный товар в корзине:  
- `index` — порядковый номер товара.  
- `IBasket` — состояние корзины:  
- `items` — массив товаров (`ICartItem[]`).  
- `isActive` — состояние корзины (активна/неактивна).  
- `total` — итоговая стоимость корзины.  

**Типы заказов:**  
- `IOrderForm` — форма заказа:  
- `payment` — выбранный способ оплаты.  
- `address` — адрес доставки.  
- `email` — электронная почта клиента.  
- `phone` — номер телефона клиента.  
- `IOrder` — объект заказа:  
- `items` — список товаров (`ICartItem[]`).  
- `total` — итоговая сумма заказа.  
- `IOrderResult` — ответ от API после оформления заказа:  
- `id` — идентификатор заказа.  
- `total` — сумма списания за заказ.  
- `IOrderFormState` — состояние формы заказа, расширяющее `IOrderForm`.  

**Типы форм:**  
- `IFormState` — состояние формы:  
- `valid` — статус валидности формы (`true/false`).  
- `errors` — массив строк с ошибками валидации.  
- `IContactsFormState` — состояние формы контактов:  
- `email` — электронная почта клиента.  
- `phone` — номер телефона клиента.  

**Типы API:**  
- `IProductAPI` — API-клиент для работы с товарами:  
- `getProductList()` — получает список товаров (`Promise<IProductItem[]>`).  
- `placeOrder(order: IOrder)` — оформляет заказ (`Promise<IOrderResult>`).  

**Типы пользователя:**  
- `IUser` — интерфейс пользователя:  
- `id` — идентификатор пользователя.  
- `name` — имя пользователя.  
- `email` — электронная почта пользователя.  

**Типы событий:**  
- `EventTypes` — перечисление событий:  
- `ADD_TO_BASKET` — добавление товара в корзину.  
- `REMOVE_FROM_BASKET` — удаление товара из корзины.  
- `ORDER_PLACED` — успешное оформление заказа.  
- `IEvent<T>` — интерфейс события:  
- `type` — тип события (`EventTypes`).  
- `data` — данные события (`T`).  

**Типы модального окна:**  
- `IModalData` — данные модального окна:  
- `content` — содержимое модального окна (`HTMLElement`).  


## Описание базовых классов и интерфейсов 
*`Базовый код`*
### Класс `EventEmitter` (паттерн "Наблюдатель") 
`constructor()`- Параметры: нет.
**Назначение:** 
Брокер событий для организации слабосвязанного взаимодействия между частями приложения. 

**Конструктор:** 
Не принимает параметров. 

**Свойства:** 
`_events: Map<EventName, Set<Subscriber>>` — карта событий и их подписчиков. 

**Методы:** 
- `on<T>(event: EventName, callback: (data: T) => void): void` — Подписывает callback на событие event с данными типа T. 
- `off(event: EventName, callback: Subscriber): void` — Отписывает callback от события event. 
- `emit<T>(event: EventName, data?: T): void` — Инициирует событие event с передачей данных типа T. 
- `onAll(callback: (event: EmitterEvent) => void): void` — подписка на все события. 
- `offAll(): void` — сбросить все подписки. 
- `trigger<T>(event: EventName, context?: Partial<T>): (data: T) => void` — возвращает callback-триггер для event с частичным контекстом типа T. 


### Класс `Form<T extends Record < string, string >>`
`constructor (container: HTMLFormElement, events: EventEmitter, initialData: T)` — корневой DOM-элемент формы, менеджер событий и начальные данные формы.

**Назначение:**
Абстрактный базовый класс для всех форм приложения. Наследники должны реализовать логику валидации, обработку событий и отправку данных. Класс инкапсулирует работу с формой в DOM, хранение состояния формы, управление состоянием кнопки отправки и отображение ошибок.

**Свойства:**
- `_element: HTMLFormElement` — корневой элемент формы (унаследован от Component<HTMLFormElement>).
- `_submitButton: HTMLButtonElement | null` — кнопка отправки формы (обычно <button type="submit">).
- `_events: EventEmitter` — менеджер пользовательских событий для взаимодействия с внешним миром.
- `_formData: T` — текущие данные формы, где ключи — поля формы, а значения — их значения.
- `_formState: IFormState` — состояние валидации формы: валидна ли форма и список ошибок.

**Методы:**
- `init(): void` — инициализация после конструктора: установка обработчика события submit и вызов setEventListeners.
- `abstract setEventListeners(): void` — абстрактный метод, который должен быть реализован наследником для установки слушателей событий на элементы формы.
- `abstract validate(): IFormState` — абстрактный метод, реализуемый наследником, для валидации текущих данных формы и возврата объекта состояния.
- `setField(field: keyof T, value: string): void` — обновляет значение указанного поля в _formData, затем вызывает валидацию и обновление состояния.
- `getData(): T` — возвращает копию текущих данных формы.
- `validateAndUpdate(): void` — вызывает validate(), обновляет _formState и состояние кнопки отправки.
- `updateSubmitButton(): void` — включает или отключает кнопку отправки в зависимости от валидности формы.
- `handleSubmit(event: SubmitEvent): void` — предотвращает стандартное действие, и если форма валидна, вызывает метод onSubmit.
- `abstract onSubmit(data: T): void` — абстрактный метод, который наследник реализует для обработки отправки данных формы.
- `clear(): void` — сбрасывает форму, очищает данные, состояние валидации и обновляет кнопку отправки.
- `showErrors(errors: string[]): void` — обновляет список ошибок в состоянии, отображает их в UI (если в форме есть элемент с классом .form__errors) и обновляет кнопку отправки.


*`Компоненты модели данных (бизнес-логика)`*

### Класс `FormModel<T extends IFormData>`  
`constructor(initialData: T)`  
- `initialData: T` — начальные данные формы.  

**Назначение:**  
Обеспечивает базовый функционал для управления данными формы, их валидацией и обработкой ошибок. Является абстрактным классом, который может быть унаследован для создания различных моделей форм.  

**Свойства:**  
- `_data: T` — текущие данные формы.  
- `_errors: IFormErrors` — ошибки валидации.  
- `_valid: boolean` — статус валидности формы.  

**Методы:**  
- `setField(field: keyof T, value: string): void` — обновляет значение указанного поля формы и запускает валидацию.  
- `getData(): T` — возвращает текущие данные формы.  
- `getErrors(): IFormErrors` — возвращает список ошибок формы.  
- `isValid(): boolean` — проверяет валидность формы.  
- `clear(): void` — очищает данные формы и запускает валидацию.  
- `validate(): void` — абстрактный метод для валидации формы, реализуется в наследниках.  

#### Класс `OrderFormModel`  
`constructor()`  

**Назначение:**  
Отвечает за обработку формы заказа, включая выбор способа оплаты и адреса доставки.  

**Свойства:**  
- `payment: string` — выбранный способ оплаты.  
- `address: string` — адрес доставки.  

**Методы:**  
- `validate(): void` — проверяет, что способ оплаты и адрес указаны корректно, формирует ошибки при необходимости.  

#### Класс `ContactsFormModel`  
`constructor()`  

**Назначение:**  
Предоставляет функциональность формы контактов, включая проверку корректности email и номера телефона.  

**Свойства:**  
- `email: string` — адрес электронной почты.  
- `phone: string` — номер телефона.  

**Методы:**  
- `validate(): void` — проверяет формат email и номера телефона, формирует ошибки при некорректных значениях.  


### Класс `ContactsValidator`  
`constructor()`  

**Назначение:**  
Отвечает за проверку корректности контактных данных (email и телефон) согласно бизнес-логике приложения. Инкапсулирует методы валидации, хранит ошибки и предоставляет механизм обработки данных.  

**Свойства:**  
- `_emailRegex: RegExp` — регулярное выражение для проверки email.  
- `_phoneRegex: RegExp` — регулярное выражение для проверки номера телефона.  
- `_errors: Record<string, string>` — объект, хранящий ошибки валидации.  

**Методы:**  
- `validateEmail(email: string): boolean` — проверяет email на корректность, обновляет `_errors` в случае ошибки. Если email пустой или имеет неверный формат, добавляет соответствующую ошибку.  
- `validatePhone(phone: string): boolean` — проверяет номер телефона, добавляет ошибку при неверном формате. Если телефон пустой или не соответствует формату, записывает ошибку.  
- `validate(contactsData: { email: string; phone: string }): boolean` — выполняет проверку email и телефона, обновляя `_errors`. Возвращает `true`, если обе проверки успешны, иначе `false`.  
- `getErrors(): Record<string, string>` — возвращает объект всех текущих ошибок.  
- `hasErrors(): boolean` — проверяет, есть ли ошибки в `_errors`. Возвращает `true`, если ошибки есть, иначе `false`.  
- `clearErrors(): void` — очищает `_errors`, удаляя все записи.  
- `getFieldError(fieldName: string): string | null` — возвращает ошибку для конкретного поля, если она присутствует, иначе `null`.  


### Класс `ContactsModel`  
`constructor(data: Partial<IContactsData> = {}, events: any)`  
- `data: Partial<IContactsData>` — начальные данные модели, могут быть частично заполнены.  
- `events: any` — менеджер событий для взаимодействия с внешними системами.  

**Назначение:**  
Предоставляет модель контактных данных пользователя с возможностью установки, валидации и очистки значений. Наследуется от `Model<IContactsData>` и интегрируется с `ContactsValidator` для проверки корректности email и телефона.  

**Свойства:**  
- `_validator: ContactsValidator` — экземпляр валидатора для проверки данных.  
- `email: string` — адрес электронной почты пользователя.  
- `phone: string` — номер телефона пользователя.  

**Методы:**  
- `setEmail(email: string): void` — устанавливает email и запускает его валидацию. При изменении эмитирует событие `'contacts:email-changed'`.  
- `setPhone(phone: string): void` — устанавливает телефон и запускает его валидацию. Эмитирует событие `'contacts:phone-changed'`.  
- `setContacts(contacts: Partial<IContactsData>): void` — обновляет все контактные данные, выполняет валидацию и отправляет событие `'contacts:changed'`.  
- `getContactsData(): IContactsData` — возвращает объект текущих контактных данных.  
- `isValid(): boolean` — выполняет валидацию email и телефона, возвращает `true`, если данные корректны.  
- `getValidationErrors(): Record<string, string>` — возвращает список ошибок валидации.  
- `getFieldError(fieldName: keyof IContactsData): string | null` — получает ошибку для конкретного поля, если она есть.  
- `clear(): void` — очищает данные, сбрасывает ошибки и эмитирует `'contacts:cleared'`.  
- `hasData(): boolean` — проверяет, содержит ли модель какие-либо контактные данные.  

### Класс `Api`  
`constructor(baseUrl: string, options?: RequestInit)`  
- `baseUrl: string` — базовый URL API.  
- `options?: RequestInit` — дополнительные опции запроса.  

**Назначение:**  
Класс используется для взаимодействия с внешними системами, предоставляя универсальные методы для выполнения HTTP-запросов, таких как `GET`, `POST`, `DELETE`. Обрабатывает ответы сервера и проверяет корректность данных.  

**Свойства:**  
- `baseUrl: string` — базовый URL API.  
- `options: RequestInit` — параметры запроса, включая заголовки.  

**Методы:**  
- `get<T>(uri: string): Promise<T>` — выполняет `GET`-запрос, возвращает данные указанного типа `T`.  
- `post<T>(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<T>` — отправляет `POST`, `PUT` или `DELETE`-запрос с данными.  
- `delete<T>(uri: string): Promise<T>` — удаляет ресурс на сервере, обрабатывает ответ.  
- `getProductList(): Promise<IProductItem[]>` — загружает список товаров с API, преобразует полученные данные из `any` в `IProductItem[]`, добавляет полный путь к изображению и выполняет проверку структуры данных перед их возвратом.  
- `handleResponse<T>(response: Response): Promise<T>` — обрабатывает HTTP-ответ, возвращает JSON-данные или ошибку.  
- `isValidProduct(item: unknown): item is IProductItem` — проверяет, соответствует ли объект ожидаемому формату `IProductItem`. Используется внутри `getProductList()` для фильтрации некорректных данных перед их обработкой.  


### Класс `AppData`  
`constructor()`  

**Назначение:**  
Класс `AppData` отвечает за хранение и управление списком товаров и корзиной покупок в локальном состоянии приложения. Позволяет добавлять, удалять и получать товары, а также управлять содержимым корзины.  

**Свойства:**  
- `_items: IProductItem[]` — массив товаров, загруженных или добавленных локально.  
- `_cart: IProductItem[]` — массив товаров, добавленных в корзину.  

**Методы:**  
- `setItems(items: IProductItem[]): void` — устанавливает список товаров.  
- `getItems(): IProductItem[]` — возвращает все товары.  
- `addItem(item: IProductItem): void` — добавляет товар в начало списка.  
- `deleteItem(itemId: string): void` — удаляет товар из списка по `id`.  
- `addToCart(item: IProductItem): void` — добавляет товар в корзину, если он ещё не был добавлен.  
- `removeFromCart(itemId: string): void` — удаляет товар из корзины по `id`.  
- `getCart(): IProductItem[]` — возвращает текущее содержимое корзины.  
- `clearCart(): void` — полностью очищает корзину.  

### Класс `AppState`  
`constructor(initialState?: { basket?: IProductItem[]; catalog?: IProductItem[]; order?: IOrder })`  

**Назначение:**  
Класс `AppState` управляет глобальным состоянием приложения, включая каталог товаров, корзину и заказ. Позволяет обновлять данные, выполнять расчеты и проверять наличие товаров в корзине.  

**Свойства:**  
- `basket: IProductItem[]` — список товаров в корзине.  
- `catalog: IProductItem[]` — данные о товарах.  
- `order: IOrder` — данные о текущем заказе.  

**Методы:**  
- `getTotal(): number` — возвращает сумму цен товаров в корзине.  
- `setCatalog(products: IProductItem[]): void` — обновляет данные каталога.  
- `addToBasket(product: IProductItem): void` — добавляет товар в корзину, если его там нет.  
- `removeFromBasket(productId: string): void` — удаляет товар из корзины.  
- `clearBasket(): void` — очищает корзину и сбрасывает заказ.  
- `clearOrder(): void` — очищает данные заказа.  
- `checkProduct(productId: string): boolean` — проверяет наличие товара в корзине.  
- `private updateOrder(): void` — обновляет данные заказа, включая итоговую сумму.  

### Класс `UserAPI`  
`constructor(api: Api)`  
- `api: Api` — клиент API для выполнения запросов к серверу.  

**Назначение:**  
Обеспечивает взаимодействие с API пользователя, выполняя запросы на получение, обновление и удаление данных. Класс отвечает только за сетевые операции и не хранит локальные данные.  

**Свойства:**  
- `_api: Api` — экземпляр API-клиента, используемый для отправки запросов.  

**Методы:**  
- `fetchUser(): Promise<IUser>` — запрашивает данные пользователя с сервера, возвращает объект `IUser`.  
- `updateUser(updates: Partial<IUser>): Promise<IUser>` — обновляет информацию о пользователе, отправляя `PUT`-запрос с измененными данными.  
- `deleteUser(): Promise<void>` — удаляет пользователя, отправляя `DELETE`-запрос.  



### Класс `UserInfo`  
`constructor()`  

**Назначение:**  
Обеспечивает локальное хранение данных пользователя и управление ими. Позволяет устанавливать, обновлять и получать данные без взаимодействия с сервером.  

**Свойства:**  
- `_data: IUser | null` — объект с данными пользователя, `null`, если данные не загружены.  

**Методы:**  
- `setUser(user: IUser): void` — сохраняет данные пользователя локально.  
- `getUser(): IUser | null` — возвращает копию данных пользователя, либо `null`, если данные отсутствуют.  
- `updateUser(updates: Partial<IUser>): void` — обновляет сохраненные данные, выбрасывает ошибку, если `_data` не загружено.  
- `clearUser(): void` — очищает сохраненные данные пользователя.  
- `hasUser(): boolean` — проверяет, загружены ли данные пользователя (`true`, если загружены).  
- `getUserId(): string | null` — возвращает ID пользователя или `null`, если данных нет.  
- `getUserName(): string | null` — возвращает имя пользователя или `null`.  
- `getUserEmail(): string | null` — возвращает email пользователя или `null`.  


### Класс `UserService`  
`constructor(userAPI: UserAPI, userInfo: UserInfo)`  
- `userAPI: UserAPI` — сервис API для работы с данными пользователя.  
- `userInfo: UserInfo` — локальное хранилище данных пользователя.  

**Назначение:**  
Класс `UserService` управляет данными пользователя, объединяя сетевые запросы и локальное хранение. Позволяет загружать, обновлять и получать данные пользователя, а также управлять их состоянием.  

**Свойства:**  
- `_userAPI: UserAPI` — клиент API для получения и обновления данных пользователя.  
- `_userInfo: UserInfo` — объект для локального хранения данных пользователя.  

**Методы:**  
- `loadUser(): Promise<IUser>` — загружает данные пользователя с сервера и сохраняет их локально.  
- `updateUser(updates: Partial<IUser>): Promise<IUser>` — обновляет данные пользователя на сервере и в локальном хранилище.  
- `getUser(): IUser | null` — возвращает сохраненные данные пользователя, либо `null`, если они отсутствуют.  
- `hasUser(): boolean` — проверяет, загружены ли данные (`true`, если данные есть).  
- `logout(): void` — очищает локальные данные пользователя.  
- `getUserName(): string | null` — возвращает имя пользователя или `null`, если данных нет.  
- `getUserEmail(): string | null` — возвращает email пользователя или `null`, если данных нет.  


*`Компоненты представления`*

### Класс `Component<T>`  
`constructor(element: T)`  
- `element: T` — корневой DOM-элемент компонента (например, `HTMLElement`, `HTMLButtonElement`).  

**Назначение:**  
Абстрактный класс для работы с интерфейсными элементами в DOM. Инкапсулирует базовые операции, позволяя изменять текст, видимость, состояния и классы элементов.  

**Свойства:**  
- `_element: T` — корневой DOM-элемент компонента, с которым работают все методы. Тип задаётся `Generic` (`HTMLElement`, `HTMLDivElement`, `HTMLButtonElement` и т. д.), что делает компонент универсальным.  

**Методы:**  
- `toggleClass(className: string): void` — добавляет или убирает CSS-класс у элемента.  
- `setText(text: string): void` — устанавливает текстовое содержание элемента.  
- `setDisabled(isDisabled: boolean): void` — включает или выключает элемент через атрибут `disabled`.  
- `setHidden(): void` — скрывает элемент, добавляя атрибут `hidden`.  
- `setVisible(): void` — делает элемент видимым, убирая атрибут `hidden`.  
- `setImage(src: string, alt: string): void` — устанавливает `src` и `alt` для элементов `<img>`.
- `render(): T` — возвращает корневой DOM-элемент компонента.  


### Класс `Page`  
`constructor(options: { counterSelector: string; catalogSelector: string; wrapperSelector: string; basketSelector: string; })`  

**Назначение:**  
Класс `Page` управляет отображением основных элементов страницы, включая каталог товаров и корзину. Обновляет счетчик корзины, контролирует прокрутку страницы и позволяет переключать состояние корзины.  

**Свойства:**  
- `_counter: HTMLElement` — элемент счетчика корзины, отображающий количество товаров.  
- `_catalog: HTMLElement` — контейнер каталога, содержащий карточки товаров.  
- `_wrapper: HTMLElement` — обертка страницы, используется для управления прокруткой.  
- `_basket: HTMLElement` — контейнер корзины, показывающий её содержимое.  

**Методы:**  
- `locked(isLocked: boolean): void` — блокирует или разблокирует прокрутку страницы, добавляя или удаляя `page__wrapper_locked`.  
- `setCounter(count: number): void` — обновляет значение счётчика корзины, устанавливая количество товаров.  
- `clearCatalog(): void` — очищает каталог перед новой отрисовкой (например, при фильтрации или обновлении данных).  
- `toggleBasket(isOpen: boolean): void` — открывает или закрывает корзину, управляя классом `basket--open`.  


### Класс `Catalog`  
`constructor(container: HTMLElement, createCard: (data: IProductItem) => Card, onCardSelect?: (data: IProductItem) => void)`  

**Назначение:**  
Инкапсулирует логику отображения карточек товаров, обеспечивает удобное обновление списка и управление элементами каталога на странице.  

**Свойства:**  
- `_container: HTMLElement` — DOM-элемент, в который рендерятся карточки товаров.  
- `_items: IProductItem[]` — список данных товаров для отображения.  
- `_createCard(data: IProductItem) => Card` — функция, принимающая данные товара и возвращающая готовый компонент `Card`.  
- `_onCardSelect?: (data: IProductItem) => void` — обработчик клика по карточке товара.  

**Методы:**  
- `render(items: IProductItem[]): void` — очищает каталог и отрисовывает список карточек.  
- `addItem(data: IProductItem): void` — создает и добавляет одну карточку в контейнер.
- `clear(): void` — полностью очищает контейнер карточек.  
- `createCatalogCard(data: IProductItem): HTMLElement` — создаёт карточку товара на основе HTML-шаблона.


### Класс `Card`  
`constructor(data: IProductItem, handleAddToCart: (item: IProductItem) => void)`  
- `data: IProductItem` — объект с данными о товаре (id, название, цена, изображение и т. д.).  
- `handleAddToCart: (item: IProductItem) => void` — обработчик клика по кнопке "Добавить в корзину".  

**Назначение:**  
Класс `Card` отвечает за создание и отображение карточки товара. Формирует визуальное представление товара, заполняет данные (название, изображение, цена, категория, описание) и обрабатывает пользовательские действия, такие как добавление товара в корзину.  

**Свойства:**  
- `_data: IProductItem` — данные о товаре.  
- `_element: HTMLElement` — корневой DOM-элемент карточки товара.  
- `_handleAddToCart: (item: IProductItem) => void` — обработчик добавления товара в корзину.  

**Методы:**  
- `_getTemplate(): HTMLElement` — загружает HTML-шаблон карточки товара, клонирует его и возвращает готовый DOM-элемент.  
- `_fillData(): void` — заполняет карточку данными (название, изображение, описание, цена, категория) и применяет стили к категории товара.  
- `_getCategoryClass(category: string): string` — определяет CSS-класс для категории товара, сопоставляя название категории с соответствующим классом.  
- `_setEventListeners(): void` — навешивает обработчик клика на кнопку "Добавить в корзину", если товар имеет цену.  
- `getElement(): HTMLElement` — возвращает текущий `_element`, удобно для рендеринга карточки в DOM.  


### Класс `Basket`  
`constructor(container: HTMLElement, totalElement: HTMLElement, createBasketItem: (data: IBasketItem, events: EventEmitter) => HTMLElement, events: EventEmitter)`  

**Назначение:**  
Обеспечивает управление состоянием корзины товаров, включая добавление, удаление и очистку. Подсчитывает общую сумму товаров и обновляет состояние кнопки оформления заказа.  

**Свойства:**  
- `_container: HTMLElement` — DOM-элемент для отображения содержимого корзины.  
- `_total: HTMLElement` — элемент для отображения общей суммы товаров.  
- `_items: IBasketItem[]` — список товаров в корзине.  
- `_createBasketItem: (data: IBasketItem, events: EventEmitter) => HTMLElement` — функция для генерации DOM-элемента товара в корзине.  
- `_checkoutButton: HTMLButtonElement` — кнопка оформления заказа, активируется при наличии товаров в корзине.  
- `events: EventEmitter` — менеджер событий для обработки пользовательских действий.  

**Методы:**  
- `render(items: IBasketItem[]): void` — очищает контейнер, отрисовывает товары, пересчитывает сумму и обновляет кнопку "Оформить".  
- `addItem(item: IBasketItem): void` — добавляет товар в корзину, если он еще не был добавлен.  
- `removeItem(itemId: string): void` — удаляет товар из корзины по `id` и обновляет список.  
- `clear(): void` — полностью очищает корзину.  
- `get items(): IBasketItem[]` — возвращает текущий список товаров.  
- `get total(): number` — возвращает общую стоимость товаров в корзине.  
- `private updateCheckoutButton(): void` — обновляет состояние кнопки "Оформить", отключая её при пустой корзине.  


### Класс `Modal`  
`constructor(popupSelector: string, events?: EventEmitter)`  
- `popupSelector: string` — CSS-селектор модального окна.  
- `events?: EventEmitter` — менеджер событий, используется для подписки на открытие и закрытие модального окна.  

**Назначение:**  
Инкапсулирует логику взаимодействия с модальным окном, включая его открытие, закрытие, обработку событий и обновление содержимого.  

**Свойства:**  
- `_popup: HTMLElement` — корневой элемент модального окна.  
- `_closeButton: HTMLElement` — кнопка закрытия модального окна.  
- `_content: HTMLElement` — контейнер для динамического содержимого модального окна.  
- `_events: EventEmitter` — менеджер событий, позволяющий другим компонентам подписываться на события открытия и закрытия модального окна.  

**Методы:**  
- `setContent(element: HTMLElement): void` — устанавливает новое содержимое в модальное окно, очищая предыдущий контент.  
- `open(): void` — открывает модальное окно, добавляя класс `modal_active` и вызывая событие `'modal:open'`.  
- `close(): void` — закрывает модальное окно, очищая содержимое и вызывая событие `'modal:close'`.  
- `isOpen(): boolean` — проверяет, открыто ли модальное окно (`true`, если оно активно).  
- `render(data: IModalData): void` — обновляет контент модального окна и открывает его.  


### Класс `Success`  
`constructor()`  

**Назначение:**  
Класс `Success` представляет компонент уведомления об успешной оплате заказа. Используется для отображения итогового списания средств и сообщения о завершении операции. Позволяет пользователю закрыть уведомление после прочтения.  

**Свойства:**  
- `template: HTMLTemplateElement` — шаблон, содержащий структуру уведомления.  
- `_message: HTMLElement` — элемент для отображения текста сообщения.  
- `_total: HTMLElement` — элемент для вывода суммы списания.  
- `_closeButton: HTMLElement` — кнопка закрытия уведомления.  

**Методы:**  
- `render(totalAmount: number, message: string): HTMLElement` — создает уведомление, обновляет текст сообщения и итоговую сумму.  
- `show(): void` — показывает модальное окно с сообщением и суммой.  
- `hide(): void` — закрывает модальное окно после успешной оплаты или по запросу пользователя.  
- `setCloseListener(handler: () => void): void` — добавляет обработчик события для кнопки закрытия.  


### Класс `Contacts`  
`constructor(formElement: HTMLFormElement, events: EventEmitter)`  

**Назначение:**  
Предоставляет обработчик формы контактной информации, включая номер телефона и электронную почту. Позволяет вводить, валидировать и передавать данные через глобальные события.  

**Свойства:**  
- `_element: HTMLFormElement` — DOM-форма для ввода контактных данных (унаследованное свойство).  
- `_inputPhone: HTMLInputElement | null` — поле для ввода номера телефона.  
- `_inputEmail: HTMLInputElement | null` — поле для ввода email.  
- `_events: EventEmitter` — менеджер событий для передачи данных и управления изменениями формы.  
- `_model: ContactsFormModel` — объект модели данных, выполняющий валидацию.  

**Методы:**  
- `setEventListeners(): void` — навешивает обработчики `input` на `_inputPhone` и `_inputEmail`, обновляет модель и форму.  
- `validate(): IFormState` — проверяет корректность введенных данных, собирает ошибки из модели.  
- `onSubmit(data: IContactsData): void` — передает данные через события `contacts:submit` и `order:success`.  
- `clear(): void` — очищает введенные данные и сбрасывает модель.  


### Класс `Model<T>`  
`constructor(data: Partial<T>, events: IEvents)`  
- `data: Partial<T>` — начальные данные модели.  
- `events: IEvents` — менеджер событий для обработки изменений.  

**Назначение:**  
Базовый абстрактный класс модели, позволяющий отличать её от обычных объектов с данными. Инкапсулирует работу с событиями и предоставляет механизм уведомления об изменениях.  

**Свойства:**  
- `events: IEvents` — менеджер событий, переданный при инициализации.  
- Данные модели передаются через `Object.assign(this, data)`, позволяя динамически заполнять объект.  

**Методы:**  
- `emitChanges(event: string, payload?: object): void` — отправляет событие с переданным `payload`, если оно указано (по умолчанию `{}`).  


### Класс `Order`  
`constructor(formElement: HTMLFormElement, buttons: HTMLElement[], events: EventEmitter)`  

**Назначение:**  
Управляет оформлением заказа, включая выбор способа оплаты, ввод адреса доставки и отправку данных. Интегрируется с моделью данных заказа и реагирует на события изменений.  

**Свойства:**  
- `_buttons: HTMLElement[]` — массив кнопок выбора способа оплаты, реагирующих на `click`.  
- `_model: OrderFormModel` — модель данных заказа, выполняющая валидацию.  
- `_addressInput: HTMLInputElement | null` — поле для ввода адреса доставки.  
- `_events: EventEmitter` — менеджер событий, позволяющий отслеживать выбор оплаты и отправку формы.  

**Методы:**  
- `setEventListeners(): void` — навешивает обработчики событий на кнопки оплаты и поле ввода адреса.  
- `validate(): IFormState` — выполняет проверку корректности данных (`payment`, `address`) и собирает ошибки.  
- `setPaymentMethod(method: string): void` — устанавливает способ оплаты, обновляет модель и стили кнопок.  
- `onSubmit(data: IOrderData): void` — передает данные заказа через `order:submit` и открывает форму контактов.  
- `clear(): void` — очищает форму заказа, сбрасывая модель и стили кнопок.  


### 3. Утилиты (`utils/utils.ts`)  

### Утилиты (`utils/utils.ts`)  

- `pascalToKebab(value: string): string` — преобразует строку из PascalCase в kebab-case.  
- `isSelector(x: any): x is string` — проверяет, является ли аргумент строкой-селектором.  
- `isEmpty(value: any): boolean` — проверяет, является ли значение пустым (`null`, `undefined`).  
- `ensureAllElements<T>(selectorElement, context?): T[]` — возвращает массив элементов по селектору или выбрасывает ошибку.  
- `ensureElement<T>(selectorElement, context?): T` — возвращает один элемент по селектору или выбрасывает ошибку, если элемент не найден.  
- `cloneTemplate<T>(query): T` — клонирует содержимое `<template>` и возвращает элемент.  
- `bem(block, element?, modifier?)` — генерирует имя класса по методологии БЭМ (`block__element_modifier`).  
- `getObjectProperties(obj, filter?)` — возвращает список свойств объекта с возможностью фильтрации.  
- `setElementData<T>(el, data)` — устанавливает dataset-атрибуты для DOM-элемента.  
- `getElementData<T>(el, scheme)` — получает типизированные dataset-данные элемента.  
- `isPlainObject(obj)` — проверяет, является ли объект простым, то есть не экземпляром класса.  
- `isBoolean(v)` — проверяет, является ли значение `boolean`.  
- `createElement<T>(tagName, props?, children?)` — создает DOM-элемент, устанавливает свойства и добавляет дочерние элементы.  


## Об архитектуре  
Проект построен по принципу событийного взаимодействия (паттерн "Наблюдатель"). 
Модели управляют данными и инициируют события при их изменении. 
Основной код слушает события, синхронизирует данные между моделями и компонентами отображения, обновляет интерфейс. 
Компоненты отвечают только за визуальное представление и не содержат бизнес-логики. 
Запросы к серверу инкапсулированы в классе Api. 
